# 📋 프로젝트 요구사항 (Requirements)

## 🎯 핵심 목표

**InsightFace 기반 얼굴 분석 백엔드로 AWS Rekognition 대체하여 비용을 절감한다.**

### 비즈니스 목표
- **비용 절감**: AWS Rekognition 대비 50% 이상 비용 절약 (월 10만회 이상 시)
- **성능 유지**: 기존 Next.js 앱의 사용자 경험 동일하게 유지
- **무중단 전환**: 점진적 전환으로 서비스 중단 없이 대체

## 🎯 MVP 기능 (최소 완성 조건)

### 1. 필수 API 엔드포인트
다음 3개 API가 **정상 동작**하면 MVP 완성:

#### 얼굴 비교 API
```
POST /compare-faces
- 두 이미지의 얼굴 유사도 계산
- AWS Rekognition과 동일한 응답 포맷
- 응답 시간 < 3초
```

#### 얼굴 감지 API  
```
POST /detect-faces
- 이미지에서 얼굴 감지 및 분석
- 나이, 성별, 감정 등 기본 속성
- 응답 시간 < 2초
```

#### 헬스체크 API
```
GET /health
- 서버 상태, 모델 로드 상태 확인
- GPU/메모리 사용량 모니터링
- 응답 시간 < 500ms
```

### 2. 성능 기준
- **정확도**: AWS Rekognition 대비 유사도 차이 < 20%
- **응답 시간**: 95% 요청이 3초 이내 응답
- **가용성**: 99% 이상 정상 응답
- **동시 처리**: 최소 10개 요청 동시 처리

### 3. 호환성 요구사항
- **Next.js 연동**: 기존 클라이언트 코드 변경 최소화
- **응답 포맷**: AWS Rekognition API와 100% 호환
- **에러 처리**: 동일한 에러 코드 및 메시지 구조

## 🚫 제외 사항 (당장 만들지 않음)

### 고급 기능들
- ❌ 실시간 영상 분석
- ❌ 배치 처리 (여러 이미지 동시 분석)
- ❌ 얼굴 인식 데이터베이스 구축
- ❌ 얼굴 추적 (동영상에서 동일 인물 추적)
- ❌ 고급 감정 분석 (미세 표정 등)

### 최적화 작업들
- ❌ GPU 클러스터링
- ❌ 모델 압축 및 양자화
- ❌ 캐싱 시스템
- ❌ 로드 밸런싱
- ❌ Auto-scaling

### 운영 기능들
- ❌ 사용량 과금 시스템
- ❌ API 키 관리 시스템
- ❌ 상세 로깅 및 분석
- ❌ A/B 테스트 프레임워크
- ❌ 백업 및 복구 시스템

## ✅ 완성 조건 (Definition of Done)

### 기술적 완성 조건
1. **InsightFace 설치**: Python 환경에서 정상 import 가능
2. **API 동작**: 3개 핵심 API 모두 정상 응답
3. **테스트 통과**: tests/ 폴더의 모든 테스트 성공
4. **문서 완성**: 설치부터 실행까지 다른 사람이 따라할 수 있는 수준

### 검증 방법
```bash
# 1. 서버 시작
python app/main.py

# 2. 헬스체크 성공
curl http://localhost:8000/health
# 응답: {"status": "healthy", "model_loaded": true}

# 3. 얼굴 비교 테스트 성공
python tests/test_api.py
# 결과: 모든 테스트 PASS

# 4. 실제 이미지로 동작 확인
python tests/test_real_images.py
# 결과: 실제 얼굴 이미지에서 유사도 계산 성공
```

### 사용자 관점 완성 조건
1. **설치 가능**: README.md만 보고 누구나 설치 성공
2. **즉시 사용**: 서버 실행 후 바로 API 호출 가능
3. **에러 없음**: 정상적인 요청에 대해 500 에러 발생 안함
4. **빠른 응답**: 일반적인 이미지(1MB 이하)로 3초 이내 응답

## 📊 성공 지표

### 정량적 지표
- **비용**: AWS 대비 월 비용 50% 이상 절감
- **정확도**: 동일 이미지 세트에서 AWS 결과와 80% 이상 일치
- **성능**: 평균 응답 시간 < 2초
- **안정성**: 24시간 연속 실행 시 99% 이상 정상 응답

### 정성적 지표
- **사용 편의성**: 개발자가 기존 코드 변경 없이 사용 가능
- **문서 품질**: 비개발자도 설치 가이드 따라 설치 성공
- **유지보수성**: 코드 구조가 명확하고 확장 가능

## 🔄 단계별 완성 계획

### Phase 1: 기본 기능 (현재 목표)
- [x] 문서화 체계 완성
- [ ] InsightFace 설치 성공
- [ ] 3개 핵심 API 구현
- [ ] 기본 테스트 통과

### Phase 2: 안정화 (선택사항)
- [ ] 에러 처리 강화
- [ ] 성능 최적화
- [ ] 모니터링 추가
- [ ] Docker 컨테이너화

### Phase 3: 연동 (선택사항)
- [ ] Next.js 프로젝트와 연동 테스트
- [ ] 점진적 전환 시스템 구축
- [ ] A/B 테스트 환경

## 🚨 중요한 제약사항

### 기술적 제약
- **Python 호환성**: Python 3.11+ 환경에서 동작 (3.12 이슈 확인됨)
- **메모리 사용량**: 단일 서버에서 2GB 이하 사용
- **GPU 의존성**: GPU 없어도 CPU로 동작 가능해야 함
- **이미지 크기**: 최대 10MB 이미지 처리 가능

### 운영 제약
- **설치 복잡도**: setup.sh 실행으로 완전 설치 가능해야 함
- **의존성**: 외부 서비스 의존성 최소화
- **호환성**: Ubuntu 20.04+ 환경에서 동작

## 📝 완성 체크리스트

### 개발 완료 확인
- [ ] InsightFace 정상 설치 및 import 성공
- [ ] `/health` API 정상 응답
- [ ] `/compare-faces` API 정상 응답
- [ ] `/detect-faces` API 정상 응답
- [ ] tests/test_api.py 모든 테스트 통과
- [ ] 실제 이미지로 동작 검증

### 문서 완료 확인
- [x] docs/SETUP.md - 설치 가이드 완성
- [x] docs/TROUBLESHOOTING.md - 문제 해결 가이드
- [x] docs/API_DESIGN.md - API 명세
- [x] README.md - 프로젝트 개요 및 빠른 시작
- [x] 이 문서 (REQUIREMENTS.md) 작성

### 품질 확인
- [ ] 다른 컴퓨터에서 README.md만 보고 설치 성공
- [ ] 24시간 연속 실행 시 메모리 누수 없음
- [ ] 동시 요청 10개 처리 시 에러 없음
- [ ] AWS와 동일한 이미지로 유사도 비교 결과 확인

---

## 💡 이 문서의 활용법

### AI 작업자용
- 작업 시작 전 이 문서를 읽고 목표 명확히 파악
- "완성 조건"에 해당하는 작업만 수행
- "제외 사항"에 있는 기능은 구현하지 않음

### 개발자용  
- 프로젝트 완성도 측정 기준
- 우선순위 결정 시 참고 자료
- 추가 기능 요청 시 Phase 2/3 검토

### 사용자용
- 프로젝트 현재 상태 파악
- 기대할 수 있는 기능 범위 확인
- 완성 시점 예측 자료

**이 문서에 명시된 MVP 기능이 모두 동작하면 프로젝트는 "완성"입니다.**

---

**작성일**: 2025-09-19  
**버전**: 1.0.0  
**다음 리뷰**: Phase 1 완료 후